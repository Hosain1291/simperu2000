<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>¡Elecciones Perú 2000! - El Simulador Web 1.0</title>
    <style>
        body {
            /* 90년대 소프트웨어의 상징적인 회색 배경 */
            background-color: #C0C0C0;
            font-family: "Times New Roman", Times, serif;
            margin: 0;
            padding: 0;
        }

        /* 800x600 해상도에 맞춘 고정폭 테이블 레이아웃 */
        table.container {
            width: 780px;
            margin: 10px auto;
            border: 2px outset #808080;
            background-color: #FFFFFF;
            border-spacing: 0;
        }

        /* --- 헤더 (90년대 스타일) --- */
        td.header {
            background-color: #000080; /* 진한 파란색 배경 */
            padding: 10px;
            border-bottom: 2px solid #000;
            text-align: center;
        }

        h1 {
            /* 90년대 웹 필수 글꼴! */
            font-family: "Comic Sans MS", cursive, sans-serif;
            color: #FFFF00; /* 노란색 텍스트 */
            margin: 0;
            font-size: 28px;
            text-shadow: 2px 2px #FF0000; /* 입체 텍스트 효과 */
        }

        /* --- 네비게이션 (링크) --- */
        td.nav {
            background-color: #E0E0E0;
            padding: 5px;
            text-align: center;
            border-bottom: 1px solid #000;
            font-size: 14px;
        }

        td.nav a {
            color: #0000FF; /* 기본 파란색 링크 */
            text-decoration: underline;
            margin: 0 10px;
            cursor: pointer; /* 가짜 링크 */
        }
        
        td.nav a:active {
            color: #FF0000;
        }

        /* --- 메인 컨텐츠 --- */
        td.main {
            padding: 20px;
            vertical-align: top;
            background: #FDFDFD;
        }
        
        td.sidebar {
            width: 200px;
            padding: 10px;
            vertical-align: top;
            background: #F0F0F0;
            border-left: 1px solid #808080;
        }

        h2 {
            font-family: Arial, Helvetica, sans-serif;
            border-bottom: 2px groove #C0C0C0;
            color: #000080;
        }
        
        h3 {
            font-family: Arial, Helvetica, sans-serif;
        }

        /* --- 90년대 스타일 UI 요소 --- */
        select, button {
            font-family: "Gulim", "돋움", Dotum, sans-serif; /* 한국어 시스템 글꼴 */
            font-size: 14px;
            border: 2px outset #A0A0A0; /* 입체 버튼 */
            background-color: #E0E0E0;
            padding: 5px;
            cursor: pointer;
        }

        button:active {
            border-style: inset; /* 버튼 눌림 효과 */
        }
        
        select {
            padding: 4px;
        }

        /* --- 게임 화면 --- */
        #game-screen {
            display: none; /* 처음에는 숨김 */
        }

        #stats-bar {
            border: 2px inset #808080;
            background: #F0F0F0;
            padding: 10px;
            margin-bottom: 15px;
        }

        #stats-bar span {
            font-weight: bold;
            font-family: Arial, sans-serif;
            font-size: 16px;
        }
        
        #round-info {
            text-align: center;
            margin-bottom: 10px;
        }
        
        #round-display {
            font-size: 20px;
            font-weight: bold;
            color: #800000;
        }
        
        #date-display {
            font-size: 16px;
            font-weight: bold;
            color: #000;
        }


        #question-box {
            border: 1px solid #000080;
            background: #F5F5FF;
            padding: 15px;
            margin-bottom: 15px;
            min-height: 80px;
        }

        #question-text {
            font-size: 18px;
            font-weight: bold;
        }

        #answers-box button {
            display: block;
            width: 100%;
            margin-bottom: 10px;
            text-align: left;
            padding: 10px;
        }

        /* 이벤트 로그: 도스(DOS) 터미널 느낌 */
        #event-log {
            width: 98%;
            height: 200px;
            background-color: #000;
            color: #00FF00; /* 초록색 텍스트 */
            font-family: "Courier New", Courier, monospace;
            font-size: 12px;
            padding: 5px;
            border: 2px inset #808080;
            white-space: pre-wrap;
            overflow-y: scroll;
        }

        #end-screen {
            display: none;
            text-align: center;
            padding: 30px;
            border: 2px dashed red;
        }
        
        /* --- [MODIFIED] 결과 차트 --- */
        #result-chart-container {
            width: 90%;
            margin: 25px auto;
            padding: 15px;
            border: 2px inset #808080;
            background-color: #F0F0F0;
        }
        .bar-chart-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .bar-label {
            width: 130px; /* 이름 표시를 위해 너비 확보 */
            font-family: Arial, sans-serif;
            font-weight: bold;
            font-size: 14px;
            padding-right: 10px;
            text-align: right;
            overflow: hidden;
            white-space: nowrap;
        }
        .bar-wrapper {
            flex-grow: 1;
            height: 30px;
            border: 1px solid #000;
            background-color: #FFF;
        }
        .bar {
            height: 100%;
            width: 0%; /* JS에서 0%로 시작 */
            transition: width 1s ease-out; /* 너비 변경 애니메이션 */
        }
        #player-bar {
            background-color: #0000B0; /* 진한 파란색 (플레이어) */
        }
        #opponent-bar {
            background-color: #B00000; /* 진한 빨간색 (상대) */
        }
        
        .bar-value {
            width: 50px;
            padding-left: 10px;
            font-family: "Courier New", monospace;
            font-weight: bold;
            font-size: 16px;
        }


        /* 90년대의 꽃, <marquee> 태그 */
        marquee {
            font-weight: bold;
            color: #FF0000;
            background-color: #FFFFE0;
            padding: 3px;
            border: 1px solid red;
        }
    </style>
</head>
<body>

    <table class="container" cellpadding="0" cellspacing="0">
        <!-- 1. 헤더 -->
        <tr>
            <td class="header" colspan="2">
                <!-- 90년대 웹사이트의 상징, 움직이는 지구본 GIF -->
                <img src="https://static.wixstatic.com/media/cd6d5a_71bfb0837fa94f1e84000e7e4988386e~mv2.gif" alt="움직이는 지구본" width="40" height="40" align="left">
                <h1>¡Simulador de Elecciones Perú 2000!</h1>
                <img src="https://gifgifs.com/animations/geography-history/international-flags/peru.gif" alt="움직이는 지구본" width="40" height="40" align="right">
            </td>
        </tr>
        <!-- 2. 네비게이션 바 (장식용) -->
        <tr>
            <td class="nav" colspan="2">
                <a href="#">■ 홈페이지 (Home)</a> |
                <a href="#">■ 후보자 프로필</a> |
                <a href="#">■ 이 사이트는... (About)</a>
            </td>
        </tr>
        <!-- 3. 메인 컨텐츠 -->
        <tr>
            <!-- 3a. 메인 컨텐츠 영역 -->
            <td class="main">
                <!-- 화면 1: 후보 선택 -->
                <div id="start-screen">
                    <marquee behavior="scroll" direction="left">
                        ¡Bienvenido! ¡페루의 2000년대를 이끌 대통령을 선택하십시오! 후지모리냐, 톨레도냐!
                    </marquee>
                    
                    <h2>¡Elija su Candidato! (후보를 선택하세요)</h2>
                    <p>1990년대의 영광과 혼란을 뒤로 하고, 페루의 새로운 밀레니엄을 이끌 단 한 명의 지도자를 선택하십시오. 2000년 페루의 운명이 당신의 손에 달렸습니다!</p>
                    
                    <p>플레이할 후보를 선택하세요:</p>
                    
                    <select id="candidate-select" style="font-size: 16px; padding: 8px;">
                        <option value="fujimori">알베르토 후지모리 (페루 2000)</option>
                        <option value="toledo">알레한드로 톨레도 (가능한 페루)</option>
                    </select>
                    <button id="start-btn" style="font-size: 16px; padding: 8px;">¡Iniciar Campaña! (캠페인 시작!)</button>
                    
                    <hr style="border: 1px dotted #808080; margin-top: 20px;">
                    <p style="font-size: 12px; color: #555;">(참고: 이 게임은 2000년 대선의 주요 두 후보에 초점을 맞추고 있습니다. 다른 후보들의 목록은 아래 이미지를 참조하십시오.)</p>
                    
                </div>

                <!-- 화면 2: 게임 진행 -->
                <div id="game-screen">
                    <h2 id="candidate-name-display"></h2>
                    <p id="party-name-display" style="font-style: italic; margin-top: -10px;"></p>

                    <div id="round-info">
                        <div id="round-display">제 1차 투표</div>
                        <div id="date-display">(D-14 / 4월 9일)</div>
                    </div>

                    <div id="stats-bar">
                        캠페인: <span id="turn-display">1</span> / 28 턴 | 현재 지지율: <span id="support-rate">30</span>%
                    </div>

                    <div id="question-box">
                        <p id="question-text"></p>
                    </div>

                    <div id="answers-box">
                        <button id="answer-1" data-effect=""></button>
                        <button id="answer-2" data-effect=""></button>
                    </div>

                </div>

                <!-- 화면 3: 결과 -->
                <div id="end-screen">
                    <h2>¡Resultados Finales! (최종 결과)</h2>
                    <p id="result-summary" style="font-size: 18px;"></p>
                    <h3>최종 지지율: <span id="final-support"></span>%</h3>
                    
                    <!-- [MODIFIED] 바 차트 영역 -->
                    <div id="result-chart-container">
                        <!-- 1, 2위 후보는 고정 -->
                        <div class="bar-chart-row">
                            <span class="bar-label" id="player-bar-label">당신:</span>
                            <div class="bar-wrapper">
                                <div class="bar" id="player-bar"></div>
                            </div>
                            <span class="bar-value" id="player-bar-value">0%</span>
                        </div>
                        <div class="bar-chart-row">
                            <span class="bar-label" id="opponent-bar-label">상대:</span>
                            <div class="bar-wrapper">
                                <div class="bar" id="opponent-bar"></div>
                            </div>
                            <span class="bar-value" id="opponent-bar-value">0%</span>
                        </div>
                        
                        <!-- 1차 투표 시 기타 후보들이 동적으로 추가될 영역 -->
                        <div id="other-candidates-chart-rows"></div>

                    </div>
                    <!-- 바 차트 영역 끝 -->
                    
                    <p id="result-message" style="font-size: 22px; font-weight: bold; margin-top: 25px;"></p>
                                        
                    <!-- [MODIFIED] 버튼 ID 변경 및 추가 -->
                    <button id="play-again-btn" onclick="location.reload()" style="font-size: 16px; padding: 10px; margin-top: 20px; display: none;">¡Jugar de Nuevo! (다시하기)</button>
                    <button id="next-step-btn" style="font-size: 16px; padding: 10px; margin-top: 20px; display: none;"></button>

                </div>
            </td>
            
            <!-- 3b. 사이드바 (로그 및 이미지) -->
            <td class="sidebar">
                <h3>주요 후보</h3>
                <!-- 사용자가 업로드한 이미지를 사용합니다 -->
                <img src="https://i.imgur.com/wR97cNB.png" alt="2000년 페루 대선 후보 목록" width="100%" style="border: 1px solid #000;">
                
                <h3 style="margin-top: 20px;">캠페인 로그</h3>
                <textarea id="event-log" readonly>*** 웹 시뮬레이터 v1.0 부팅 ***
*** 2000년 대선 모듈 로드 ***
후보를 선택하고 캠페인을 시작하세요...</textarea>
            </td>
        </tr>
        <!-- 4. 푸터 (저작권) -->
        <tr>
            <td class="nav" colspan="2" style="border-top: 1px solid #000;">
                <p style="font-size: 12px; margin: 0;">© 1999-2000 Simulador Web. 이 사이트는 Netscape Navigator 4.0과 Internet Explorer 5.0에 최적화되어 있습니다.</p>
                <img src="https.cyber.dabamos.de/88x31/ie.gif" alt="IE 5">
                <img src="https.cyber.dabamos.de/88x31/netscape.gif" alt="Netscape">
            </td>
        </tr>
    </table>

<script>
    // --- 후보 정보 ---
    const C_DATA = {
        'fujimori': { name: "알베르토 후지모리", party: "페루 2000 (Peru 2000)", startSupport: 42, color: "#ff6600" }, // 주황색
        'toledo': { name: "알레한드로 톨레도", party: "가능한 페루 (Possible Peru)", startSupport: 35, color: "#006400" }  // 녹색
    };
    
    // 1차 투표의 기타 후보들 정보 (이미지 기반)
    const OTHER_CANDIDATES_DATA = [
        // 실제 득표율 (총합 10.4%)을 기준으로 비율 설정
        { name: 'A. 안드라데', ratio: 3.0, color: '#007bff' },
        { name: 'F. 살라스', ratio: 2.5, color: '#28a745' },
        { name: 'L. 카스타녜다', ratio: 1.8, color: '#ffc107' },
        { name: 'A. 살리나스', ratio: 1.4, color: '#dc3545' },
        { name: 'E. 아타우쿠시', ratio: 0.9, color: '#000080' },
        { name: 'V. 가르시아 B.', ratio: 0.5, color: '#343a40' },
        { name: 'M. 산 로만', ratio: 0.3, color: '#8B0000' }
    ];
    const OTHER_CANDIDATES_TOTAL_RATIO = 10.4; // 위 후보들 실제 득표율 총합
    const OTHER_CANDIDATES_TOTAL_SCORE_PERCENT = 10; // 게임에서 이들에게 할당할 총 득표율

    // --- 질문 데이터 ---
    const Q_DATA = {
        'fujimori': [
            { q: "벌써 10년째 집권 중입니다. 헌법을 초월한 3선 연임 시도에 '독재'라는 비판이 거셉니다.", a: [{ text: "테러를 종식하고 경제를 살린 '강력한 리더십'이 계속 필요함을 역설한다.", effect: 4 }, { text: "민주주의 절차를 존중한다고 원론적인 답변만 한다.", effect: -3 }] },
            { q: "정보부 수장 '블라디미로 몬테시노스'의 월권과 부패 의혹이 계속 제기됩니다. 그를 경질해야 할까요?", a: [{ text: "그는 '테러와의 전쟁' 1등 공신이다. 음해 세력으로부터 그를 보호한다.", effect: -6 }, { text: "의혹을 엄중히 주시하고 있으며, 문제 발견 시 조치하겠다고 밝힌다.", effect: 2 }] },
            { q: "야당 후보 톨레도가 TV 토론을 공식 제안했습니다. 응하시겠습니까?", a: [{ text: "나는 말보다 행동으로 증명했다. 실무에 집중하겠다며 토론을 거부한다.", effect: -4 }, { text: "기꺼이 응한다. 나의 10년간의 성과를 페루 전역에 알릴 기회다.", effect: 3 }] },
            { q: "주요 방송국들이 노골적으로 당신을 지지하고 야당을 비판하는 '관제 언론' 행태를 보입니다.", a: [{ text: "언론의 자유로운 판단일 뿐, 정부는 개입하지 않았다고 주장한다.", effect: -5 }, { text: "모든 언론에 '공정 보도'를 요청하는 대국민 성명을 발표한다.", effect: 2 }] },
            { q: "군부의 '라 칸투타' 학살 등 인권 유린 문제에 대한 사과 요구가 나옵니다.", a: [{ text: "테러리스트 소탕 과정에서 발생한 불가피한 희생이었다고 강변한다.", effect: -7 }, { text: "유감을 표명하며, 진상 조사를 통해 책임을 묻겠다고 약속한다.", effect: 3 }] },
            { q: "경제 성장의 과실이 리마에만 집중되고, 지방은 여전히 가난하다는 '불균형 발전' 비판이 있습니다.", a: [{ text: "지방 개발을 위한 '제2차 신자유주의 개혁'을 약속한다.", effect: 3 }, { text: "먼저 수도가 부유해져야 낙수 효과가 생긴다고 반박한다.", effect: -4 }] },
            { q: "톨레도 후보가 당신을 '부패한 독재자'라고 맹비난했습니다.", a: [{ text: "그를 '경험 없는 선동가'라고 맞받아치며 네거티브 공방을 벌인다.", effect: 0 }, { text: "비방 대신 정책으로 승부하자며 '국부'의 이미지를 강조한다.", effect: 2 }] },
            { q: "미국 정부가 페루의 민주주의 후퇴와 인권 문제에 '우려'를 표명했습니다.", a: [{ text: "페루의 주권을 침해하는 '내정간섭'이라고 강력히 항의한다.", effect: 2 }, { text: "미국은 우리의 동맹이다. 우려를 불식시키기 위해 대화하겠다.", effect: 1 }] },
            { q: "당신의 딸 '케이코 후지모리'가 퍼스트 레이디 역할을 훌륭히 수행하고 있습니다. 그녀를 선거 전면에 내세울까요?", a: [{ text: "적극적으로 내세운다. '따뜻한 아버지'와 '안정된 가족' 이미지를 부각한다.", effect: 3 }, { text: "선거는 나의 몫이다. 가족을 정치에 끌어들이지 않는다.", effect: 0 }] },
            { q: "과거 당신의 부통령이었던 '막시모 산 로만'이 이제 당신의 반대편에 섰습니다.", a: [{ text: "그는 '권력욕에 눈이 먼 배신자'일 뿐이라고 평가절하한다.", effect: -2 }, { text: "정치적 견해 차이일 뿐이다. 그를 존중한다고 말한다.", effect: 1 }] },
            { q: "수도 리마 시장 '안드라데'가 톨레도 대신 당신을 지지할 수도 있다는 소문이 돕니다.", a: [{ text: "즉시 그와 물밑 접촉을 시도하여 '반(反) 톨레도 연대'를 구축한다.", effect: 4 }, { text: "필요 없다. 나 혼자서도 50% 이상 득표할 수 있다.", effect: -3 }] },
            { q: "지식인층이 '민주주의의 회복'을 외치며 톨레도 지지를 선언하고 있습니다.", a: [{ text: "그들은 현실을 모르는 '탁상공론가'들이다. '서민'들은 나를 지지한다.", effect: -2 }, { text: "지식인 사회의 비판을 겸허히 수용하고 소통을 강화하겠다.", effect: 2 }] },
            { q: "당신의 지지 기반인 농촌 지역에 대규모 '식량 및 농기구 지원' 예산을 투입하시겠습니까?", a: [{ text: "즉시 집행한다. '일하는 대통령'의 이미지를 굳힌다.", effect: 5 }, { text: "선거법 위반 소지가 있다. 대선 이후로 집행을 미룬다.", effect: -4 }] },
            { q: "10년간의 집권으로 피로감을 느끼는 유권자들이 보입니다.", a: [{ text: "개혁은 아직 끝나지 않았다. '안정 속의 전진'을 호소한다.", effect: 3 }, { text: "이번이 정말 마지막 임기임을 강조하며 지지를 호소한다.", effect: 1 }] },
            { q: "몬테시노스가 톨레도 후보의 '사생활 스캔들'을 담은 자료를 입수했다고 보고했습니다.", a: [{ text: "즉시 언론에 유포하여 톨레도의 도덕성에 치명타를 입힌다.", effect: 3 }, { text: "선거가 혼탁해진다. 정보부에 '선거 중립'을 지시하고 자료를 폐기한다.", effect: 0 }] }
        ],
        'toledo': [
            { q: "당신의 '인디오' 혈통이 주목받고 있습니다. '엘 촐로(El Cholo, 인디오 혼혈)' 이미지를 어떻게 활용하시겠습니까?", a: [{ text: "소외된 원주민과 서민을 대변하는 '진짜 페루인'임을 전면에 내세운다.", effect: 6 }, { text: "혈통이 아닌 '경제학자'로서의 전문성으로 승부하겠다며 거리둔다.", effect: -3 }] },
            { q: "후지모리 정권의 '신자유주의' 경제 성과는 인정하지만, 빈부 격차가 심화되었습니다. 당신의 해법은?", a: [{ text: "'얼굴 있는 시장 경제'를 제시. 성장과 분배, 두 마리 토끼를 잡겠다고 약속한다.", effect: 5 }, { text: "후지모리식 경제 정책을 전면 폐기하고 '국가 주도 경제'로 돌아가겠다.", effect: -4 }] },
            { q: "후지모리가 강력한 TV 토론 제안을 거부하고 있습니다. 어떻게 대응하시겠습니까?", a: [{ text: "후지모리가 토론을 '두려워한다'고 비판하며, 그의 빈자리에 의자를 놓고 토론회를 강행한다.", effect: 4 }, { text: "유감이지만, TV 토론 없이 정책 홍보에만 집중한다.", effect: -2 }] },
            { q: "당신의 아내 '엘리안 카프'가 벨기에 태생의 외국인이라는 점이 공격받고 있습니다.", a: [{ text: "그녀는 페루의 고대 문화를 사랑하는 '준비된 퍼스트 레이디'임을 강조한다.", effect: 3 }, { text: "아내를 선거 운동에서 배제하고, 혼자 유세에 나선다.", effect: -2 }] },
            { q: "'일자리 100만 개 창출' 공약이 비현실적이라는 비판이 있습니다.", a: [{ text: "외국인 직접 투자를 유치하고 중소기업을 육성하면 '가능하다'고 자신한다.", effect: 4 }, { text: "공약 달성이 어려울 수 있음을 인정하고, 목표치를 하향 조정한다.", effect: -5 }] },
            { q: "후지모리 정권이 장악한 언론이 당신의 사소한 말실수나 스캔들(피스코 주사 의혹 등)을 집중포화합니다.", a: [{ text: "모두 '정치 공작'이며 '가짜 뉴스'라고 정면 반박하며 후지모리를 비난한다.", effect: 2 }, { text: "의혹에 대해 일부 시인하고 '인간적인 실수'였다며 대중에게 사과한다.", effect: 0 }] },
            { q: "리마 시장 '안드라데'가 당신이 아닌 후지모리와 연대할 수도 있다는 관측이 나옵니다.", a: [{ text: "그와 만나 '민주주의 회복'을 위한 '반(反)후지모리 단일화'를 제안한다.", effect: 5 }, { text: "그는 어차피 군소 후보다. 독자 노선으로 승리하겠다.", effect: -3 }] },
            { q: "미국과 유럽이 페루의 민주주의 회복을 촉구하며 당신에게 힘을 실어주고 있습니다.", a: [{ text: "국제 사회의 지지를 적극 환영하며, '민주주의의 승리'를 위해 협력하겠다.", effect: 3 }, { text: "이는 페루의 내정이다. 외세의 개입 없이 선거를 치르겠다.", effect: -2 }] },
            { q: "후지모리의 '테러 종식' 성과를 어떻게 평가하시겠습니까?", a: [{ text: "성과는 인정하지만, 그 과정에서 수많은 '인권 유린'이 있었음을 비판한다.", effect: 4 }, { text: "테러 종식은 군부의 공일 뿐, 후지모리는 한 일이 없다고 평가절하한다.", effect: -2 }] },
            { q: "당신의 지지자들이 후지모리의 3선 연임에 반대하는 대규모 시위 '4개 주로의 행진(Marcha de los Cuatro Suyos)'을 기획 중입니다.", a: [{ text: "시위를 적극 독려한다. '민주주의를 향한 국민의 열망'을 보여주자.", effect: 5 }, { text: "선거를 앞두고 사회 혼란이 우려된다. 시위 자제를 요청한다.", effect: -4 }] },
            { q: "당신이 대통령이 되면 '몬테시노스'와 '군부'를 어떻게 처리하시겠습니까?", a: [{ text: "즉시 '몬테시노스'를 해임하고, 군부의 정치 개입을 원천 차단하겠다.", effect: 6 }, { text: "국정 안정을 위해 그들과 타협하고, 점진적인 개혁을 추진하겠다.", effect: -5 }] },
            { q: "당신이 스탠퍼드 대학에서 경제학을 공부한 '엘리트'라는 점이 서민층에게 위화감을 줄 수 있습니다.", a: [{ text: "가난한 구두닦이 소년에서 '미국 박사'가 된 '성공 신화'를 강조한다.", effect: 4 }, { text: "엘리트 이미지를 숨기고, 서민들과 어울리는 모습만 연출한다.", effect: -2 }] },
            { q: "과거 APRA 정권(알란 가르시아)의 경제 실패 때문에 '민주 정부'에 대한 불신이 남아있습니다.", a: [{ text: "나는 그들과 다르다. '유능한 경제 전문가'임을 내세워 불신을 해소한다.", effect: 3 }, { text: "과거 민주 정부의 실수를 비판하며 APRA와 거리두기를 한다.", effect: 1 }] },
            { q: "수도 리마의 지지율이 후지모리에게 밀리고 있습니다. 리마 유권자들을 어떻게 공략하시겠습니까?", a: [{ text: "리마의 중산층을 겨냥해 '세금 감면'과 '안정적인 일자리'를 약속한다.", effect: 4 }, { text: "리마보다는 나의 핵심 기반인 '안데스'와 '지방' 공략에 집중한다.", effect: -2 }] },
            { q: "당신의 핵심 공약인 '교육 예산 2배 증액'의 재원 마련 방안이 비현실적이라는 지적이 있습니다.", a: [{ text: "정부의 '부패 예산'을 척결하고 '긴축 재정'을 통해 충분히 가능하다.", effect: 3 }, { text: "증세가 불가피함을 솔직하게 인정하고 국민들의 동의를 구한다.", effect: -4 }] }
        ],
        'common': [
            // (질문 데이터는 이전과 동일, 생략)
            { q: "선거를 3주 앞두고, 아마존 정글에서 '빛나는 길' 잔당이 군부대를 습격하는 테러가 발생했습니다.", a: [{ text: "테러리스트와의 '타협 없는 전쟁'을 선포하고 군 통수권자로서의 강인함을 보인다.", effect: 4 }, { text: "테러의 원인은 '빈곤'과 '소외'다. 무력 진압보다 '사회 통합'이 우선이다.", effect: -3 }] },
            { q: "경제 위기로 인해 청년 실업률이 20%에 육박하고 있습니다. 가장 시급한 대책은?", a: [{ text: "대규모 인프라 건설(도로, 항만)로 '공공 일자리'를 즉시 창출한다.", effect: 3 }, { text: "외국인 투자를 유치하기 위해 '법인세'를 대폭 인하한다.", effect: 2 }] },
            { q: "국제 NGO가 페루의 '부패인식지수'가 매우 심각하다고 발표했습니다. 어떻게 대응하시겠습니까?", a: [{ text: "'대통령 직속 반부패 위원회'를 설치하고, 고위 공직자 재산을 투명하게 공개하겠다.", effect: 5 }, { text: "부패는 어느 나라에나 있다. 경제 성장이 더 시급한 문제다.", effect: -4 }] },
            { q: "콜롬비아와의 국경 지대에서 '마약 카르텔' 조직이 체포되었습니다. 마약 문제의 근절 대책은?", a: [{ text: "미국 'DEA(마약단속국)'와의 공조를 강화하고, 군대를 투입해 '마약과의 전쟁'을 벌인다.", effect: 4 }, { text: "코카 재배 농민들에게 '대체 작물'을 지원하는 것이 근본적인 해결책이다.", effect: 2 }] },
            { q: "페루의 만성적인 '사법 불신'을 해결하기 위해, '사법부 개혁'을 요구하는 목소리가 높습니다.", a: [{ text: "대법관 임명 절차를 투명하게 바꾸고, '국민참여재판' 제도를 도입한다.", effect: 3 }, { text: "사법부의 독립성을 존중한다. 행정부가 개입할 사안이 아니다.", effect: -2 }] },
            { q: "의사들이 '공공 의료 예산 확충'을 요구하며 총파업을 예고했습니다.", a: [{ text: "즉시 의사들과 대화에 나서고, '건강보험 적용 확대'를 약속한다.", effect: 4 }, { text: "불법 파업에는 타협 없다. 법과 원칙에 따라 엄정 대응하겠다.", effect: -3 }] },
            { q: "전국 교사 노조가 '교사 임금 현실화'를 요구하며 시위를 벌이고 있습니다.", a: [{ text: "교육은 백년지대계다. 'GDP 대비 교육 예산 2배'를 공약한다.", effect: 4 }, { text: "국가 재정이 어렵다. 임금 동결을 받아들이고 교육 현장으로 복귀하라.", effect: -4 }] },
            { q: "페루 남부 아레키파 주에서 '수도 리마 중심의 발전'에 항의하며 '자치권 확대'를 요구합니다.", a: [{ text: "과감한 '지방 분권'과 '재정 자립'을 약속한다.", effect: 3 }, { text: "페루는 '하나의 국가'다. 분리주의적 행동은 용납할 수 없다.", effect: -2 }] },
            { q: "IMF가 페루의 '재정 적자'를 경고하며, '공기업 민영화'와 '복지 축소'를 요구했습니다.", a: [{ text: "IMF의 요구를 수용해야 외국인 투자가 들어온다. 고통 분담을 호소한다.", effect: 1 }, { text: "IMF의 과도한 개입을 비판한다. 페루의 현실에 맞는 '독자 노선'을 가겠다.", effect: 2 }] },
            { q: "선거 막판, 지지율 3위 후보(안드라데)가 사퇴하며 특정 후보 지지를 선언할 수 있습니다.", a: [{ text: "즉시 그에게 접촉해 '내각 참여'를 조건으로 당신에 대한 지지를 요청한다.", effect: 5 }, { text: "정치적 야합은 없다. 정정당당하게 1:1 구도로 승부하겠다.", effect: 0 }] },
            { q: "수도 리마의 교통 체증이 심각합니다. 해결책은?", a: [{ text: "파리의 '메트로'를 본뜬 지하철 건설을 즉시 시작하겠습니다.", effect: 4 }, { text: "순환 도로를 확장하고 '버스 전용 차선'을 도입하겠습니다.", effect: 2 }] },
            { q: "에콰도르와의 국경 분쟁이 최근에야 종식(1998년)되었습니다. 이 평화 협정을 어떻게 평가하십니까?", a: [{ text: "페루의 영토를 일부 양보한 '굴욕 외교'였다고 비판한다.", effect: -3 }, { text: "전쟁의 위협을 끝낸 '역사적인 결단'이었다고 옹호한다.", effect: 4 }] },
            { q: "안데스 산악 지대의 '교육 불평등'이 심각합니다. 원주민 학생들을 위한 대책은?", a: [{ text: "원주민 언어(케추아어)와 스페인어 '이중 언어 교육'을 의무화한다.", effect: 4 }, { text: "모든 학생은 미래을 위해 스페인어로 통일된 교육을 받아야 한다.", effect: -2 }] },
            { q: "관광 산업을 육성하기 위한 아이디어는?", a: [{ text: "'마추픽추' 외에 '쿠스코', '아레키파' 등 다른 유적지를 적극 홍보한다.", effect: 3 }, { text: "관광객 유치를 위해 리마 해변에 대형 '카지노 리조트'를 건설한다.", effect: 1 }] },
            { q: "심각한 '환경 오염' 문제 (불법 광산, 도시 스모그)가 대두됩니다.", a: [{ text: "환경 규제를 대폭 강화하고 '녹색 성장'을 추진한다.", effect: 3 }, { text: "성장이 우선이다. 환경 규제는 기업 활동을 위축시킨다.", effect: -3 }] }
        ]
    };
    
    // --- 게임 상태 변수 ---
    let gameState = {
        candidateId: null,
        candidateName: "",
        partyName: "",
        color: "",
        support: 30,
        turn: 1, 
        round: 1,
        maxTurnRound1: 14, 
        maxTurnRunoff: 28, 
        questionPool: []
    };

    // --- DOM 요소 ---
    const startScreen = document.getElementById('start-screen');
    const gameScreen = document.getElementById('game-screen');
    const endScreen = document.getElementById('end-screen');
    const candidateSelect = document.getElementById('candidate-select');
    const startBtn = document.getElementById('start-btn');
    
    const candidateNameDisplay = document.getElementById('candidate-name-display');
    const partyNameDisplay = document.getElementById('party-name-display');
    const turnDisplay = document.getElementById('turn-display'); 
    const supportRateDisplay = document.getElementById('support-rate');
    const roundDisplay = document.getElementById('round-display');
    const dateDisplay = document.getElementById('date-display'); 
    
    const questionText = document.getElementById('question-text');
    const answer1 = document.getElementById('answer-1');
    const answer2 = document.getElementById('answer-2');
    const eventLog = document.getElementById('event-log');

    const resultSummary = document.getElementById('result-summary');
    const finalSupport = document.getElementById('final-support');
    const resultMessage = document.getElementById('result-message');
    
    const playerBarLabel = document.getElementById('player-bar-label');
    const playerBar = document.getElementById('player-bar');
    const playerBarValue = document.getElementById('player-bar-value');
    const opponentBarLabel = document.getElementById('opponent-bar-label');
    const opponentBar = document.getElementById('opponent-bar');
    const opponentBarValue = document.getElementById('opponent-bar-value');
    
    const otherCandidatesChartRows = document.getElementById('other-candidates-chart-rows');
    
    // [NEW] 버튼 DOM 요소
    const playAgainBtn = document.getElementById('play-again-btn');
    const nextStepBtn = document.getElementById('next-step-btn');


    // --- 이벤트 로그 함수 ---
    function logEvent(message) {
        const roundText = (gameState.round === 1) ? "1차" : "결선";
        const turnText = (gameState.round === 1) ? gameState.turn : (gameState.turn - gameState.maxTurnRound1);
        
        let dDay = 0;
        if (gameState.round === 1) {
            dDay = gameState.maxTurnRound1 - gameState.turn + 1;
        } else {
            dDay = gameState.maxTurnRunoff - gameState.turn + 1;
        }
        const timestamp = `[${roundText} D-${dDay} / ${turnText}턴] `;
        
        eventLog.value = timestamp + message + "\n" + eventLog.value;
    }

    // --- 게임 시작 ---
    startBtn.addEventListener('click', () => {
        const selectedId = candidateSelect.value;
        gameState.candidateId = selectedId;
        gameState.candidateName = C_DATA[selectedId].name;
        gameState.partyName = C_DATA[selectedId].party;
        gameState.support = C_DATA[selectedId].startSupport;
        gameState.color = C_DATA[selectedId].color; 
        gameState.turn = 1;
        gameState.round = 1;

        let fullPool = [...Q_DATA[selectedId], ...Q_DATA.common];
        fullPool.sort(() => 0.5 - Math.random()); 
        gameState.questionPool = fullPool.slice(0, gameState.maxTurnRunoff); 
        
        candidateNameDisplay.textContent = gameState.candidateName;
        partyNameDisplay.textContent = gameState.partyName;
        supportRateDisplay.textContent = gameState.support;
        turnDisplay.textContent = `${gameState.turn} / ${gameState.maxTurnRunoff}`;
        roundDisplay.textContent = "제 1차 투표";
        dateDisplay.textContent = "(D-" + (gameState.maxTurnRound1 - gameState.turn + 1) + " / 4월 9일)";


        logEvent(`'${gameState.candidateName}' 후보의 캠페인이 시작되었습니다. (초기 지지율: ${gameState.support}%)`);

        startScreen.style.display = 'none';
        gameScreen.style.display = 'block';

        displayQuestion();
    });

    // --- 질문 표시 ---
    function displayQuestion() {
        const currentQ = gameState.questionPool[gameState.turn - 1];
        
        questionText.textContent = currentQ.q;
        
        answer1.textContent = currentQ.a[0].text;
        answer1.dataset.effect = currentQ.a[0].effect;
        
        answer2.textContent = currentQ.a[1].text;
        answer2.dataset.effect = currentQ.a[1].effect;
        
        supportRateDisplay.textContent = gameState.support;
        turnDisplay.textContent = `${gameState.turn} / ${gameState.maxTurnRunoff}`;
        
        if (gameState.round === 1) {
            roundDisplay.textContent = "제 1차 투표";
            dateDisplay.textContent = "(D-" + (gameState.maxTurnRound1 - gameState.turn + 1) + " / 4월 9일)";
        } else {
             roundDisplay.textContent = "결선 투표";
             dateDisplay.textContent = "(D-" + (gameState.maxTurnRunoff - gameState.turn + 1) + " / 5월 28일)";
        }
    }

    // --- 답변 선택 ---
    answer1.addEventListener('click', handleAnswer);
    answer2.addEventListener('click', handleAnswer);
    
    // [NEW] 결선 투표 진행 버튼 리스너
    nextStepBtn.addEventListener('click', startRunoff);

    function handleAnswer(event) {
        const supportChange = parseInt(event.target.dataset.effect, 10);

        gameState.support += supportChange;
        
        if (gameState.support > 100) gameState.support = 100;
        if (gameState.support < 0) gameState.support = 0;

        const logMsg = `'${event.target.textContent}' 선택. 지지율 ${supportChange > 0 ? '+' : ''}${supportChange}% (현재: ${gameState.support}%)`;
        logEvent(logMsg);

        gameState.turn++;

        if (gameState.round === 1 && gameState.turn > gameState.maxTurnRound1) {
            // [MODIFIED] 1차 투표 종료 시, 무조건 결과부터 확인
            checkRound1Result();
        } else if (gameState.round === 2 && gameState.turn > gameState.maxTurnRunoff) {
            endGame(true);
        } else {
            displayQuestion();
        }
    }
    
    // --- [MODIFIED] 1차 투표 결과 확인 ---
    function checkRound1Result() {
        logEvent(`--- 제 1차 투표일 (4월 9일) --- (현재 지지율: ${gameState.support}%)`);
        
        if (gameState.support >= 50) {
            endGame(false, "win_round1");
        } else if (gameState.support < 40) {
            endGame(false, "lose_round1");
        } else {
            // [NEW] 결선 진출 시, endGame을 'goto_runoff' 모드로 호출
            endGame(false, "goto_runoff");
        }
    }
    
    // [NEW] 결선 투표 시작 함수
    function startRunoff() {
        gameState.round = 2;
        const opponent = (gameState.candidateId === 'fujimori') ? '알레한드로 톨레도' : '알베르토 후지모리';
        logEvent(`--- 결선 투표(5/28)가 시작됩니다! ${opponent} 후보와 1:1 대결입니다! ---`);
        
        // 결선 투표 보너스/패널티
        if(gameState.candidateId === 'toledo') {
            logEvent("결선 투표 진출로 '민주주의' 열망이 결집합니다! (지지율 +3%)");
            gameState.support += 3;
        } else {
            logEvent("3선 연임에 대한 저항으로 야권이 결집합니다. (지지율 -3%)");
            gameState.support -= 3;
        }
        
        // 1차 투표 차트 정리
        otherCandidatesChartRows.innerHTML = '';
        
        // 화면 전환
        endScreen.style.display = 'none';
        gameScreen.style.display = 'block';
        
        displayQuestion(); // 15턴째 질문 표시
    }

    // --- [MODIFIED] 게임 종료 ---
    function endGame(isRunoff, resultType = "") {
        gameScreen.style.display = 'none';
        endScreen.style.display = 'block';

        const playerScore = gameState.support;
        let opponentScore = 0;
        
        const opponentId = (gameState.candidateId === 'fujimori') ? 'toledo' : 'fujimori';
        const opponentName = C_DATA[opponentId].name;
        const opponentColor = C_DATA[opponentId].color;
        
        finalSupport.textContent = playerScore;
        
        let msg = "";
        let summary = "";
        
        // 차트 컨테이너 초기화
        otherCandidatesChartRows.innerHTML = '';
        otherCandidatesChartRows.style.display = 'none';
        playAgainBtn.style.display = 'none';
        nextStepBtn.style.display = 'none';


        if (isRunoff) {
            // [결선 투표 결과]
            summary = `결선 투표 (5월 28일) 결과, 최종 지지율 ${playerScore}%를 기록했습니다.`;
            opponentScore = 100 - playerScore;
            
            if (playerScore >= 50) {
                msg = "¡Victoria Total! 당신이 페루의 새 대통령입니다!";
                msg += (gameState.candidateId === 'toledo') ? "\n독재를 끝내고 민주주의를 되찾았습니다!" : "\n페루의 안정과 번영을 계속 이끌게 되었습니다!";
                resultMessage.style.color = "green";
            } else {
                msg = "¡Derrota! 결선 투표에서 석패했습니다.";
                msg += (gameState.candidateId === 'toledo') ? "\n부정 선거 의혹이 있지만, 후지모리의 3선 연임을 막지 못했습니다." : "\n10년간의 집권에 대한 국민들의 피로감을 넘지 못했습니다.";
                resultMessage.style.color = "red";
            }
            playAgainBtn.style.display = 'block'; // 최종 결과이므로 다시하기 버튼 표시

        } else {
            // [1차 투표 결과]
            summary = `제 1차 투표 (4월 9일) 결과, 최종 지지율 ${playerScore}%를 기록했습니다.`;
            
            opponentScore = 100 - playerScore - OTHER_CANDIDATES_TOTAL_SCORE_PERCENT;
            if (opponentScore < 0) opponentScore = 0;
            
            otherCandidatesChartRows.style.display = 'block';
            
            let otherBarsHtml = '';
            OTHER_CANDIDATES_DATA.forEach(candidate => {
                let score = (candidate.ratio / OTHER_CANDIDATES_TOTAL_RATIO) * OTHER_CANDIDATES_TOTAL_SCORE_PERCENT;
                score = score.toFixed(1);
                
                otherBarsHtml += `
                    <div class="bar-chart-row">
                        <span class="bar-label">${candidate.name}:</span>
                        <div class="bar-wrapper">
                            <div class="bar" style="width: 0%; background-color: ${candidate.color};" data-score="${score}"></div>
                        </div>
                        <span class="bar-value">${score}%</span>
                    </div>
                `;
            });
            otherCandidatesChartRows.innerHTML = otherBarsHtml;

            // 1차 투표 결과에 따른 분기
            if (resultType === "win_round1") {
                msg = "¡Victoria Aplastante! 1차 투표에서 과반을 확보했습니다!";
                msg += "\n결선 투표 없이 대통령에 당선되었습니다!";
                resultMessage.style.color = "blue";
                playAgainBtn.style.display = 'block'; // 최종 결과
            } else if (resultType === "lose_round1") {
                msg = "¡Fracaso! 1차 투표에서 2위 안에 들지 못해 탈락했습니다.";
                msg += "\n결선 투표 진출에 실패했습니다.";
                resultMessage.style.color = "red";
                playAgainBtn.style.display = 'block'; // 최종 결과
            } else if (resultType === "goto_runoff") {
                msg = "과반 득표자 없음! 2위와 결선 투표로 갑니다!";
                resultMessage.style.color = "blue";
                nextStepBtn.style.display = 'block'; // [NEW] 결선 가기 버튼 표시
                nextStepBtn.textContent = "결선 투표(5/28) 시작 ➔";
            }
        }

        resultSummary.textContent = summary;
        resultMessage.innerText = msg;
        
        // 차트 업데이트 로직
        playerBarLabel.textContent = `${gameState.candidateName}:`;
        playerBarValue.textContent = `${playerScore}%`;
        playerBar.style.backgroundColor = gameState.color; 
        
        opponentBarLabel.textContent = `${opponentName}:`;
        opponentBarValue.textContent = `${opponentScore}%`;
        opponentBar.style.backgroundColor = opponentColor; 
        
        
        // CSS 애니메이션
        setTimeout(() => {
            playerBar.style.width = `${playerScore}%`;
            opponentBar.style.width = `${opponentScore}%`;
            
            if (!isRunoff) {
                const otherBars = document.querySelectorAll('#other-candidates-chart-rows .bar');
                otherBars.forEach(bar => {
                    bar.style.width = `${bar.dataset.score}%`;
                });
            }
        }, 100);
    }

</script>

</body>
</html>


