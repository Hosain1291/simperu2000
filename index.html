<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>¡Elecciones Perú 2000! - El Simulador Web 1.0</title>
    <style>
        body {
            /* 90년대 소프트웨어의 상징적인 회색 배경 */
            background-color: #C0C0C0;
            font-family: "Times New Roman", Times, serif;
            margin: 0;
            padding: 0;
        }

        /* 800x600 해상도에 맞춘 고정폭 테이블 레이아웃 */
        table.container {
            width: 780px;
            margin: 10px auto;
            border: 2px outset #808080;
            background-color: #FFFFFF;
            border-spacing: 0;
        }

        /* --- 헤더 (90년대 스타일) --- */
        td.header {
            background-color: #000080; /* 진한 파란색 배경 */
            padding: 10px;
            border-bottom: 2px solid #000;
            text-align: center;
        }

        h1 {
            /* 90년대 웹 필수 글꼴! */
            font-family: "Comic Sans MS", cursive, sans-serif;
            color: #FFFF00; /* 노란색 텍스트 */
            margin: 0;
            font-size: 28px;
            text-shadow: 2px 2px #FF0000; /* 입체 텍스트 효과 */
        }

        /* --- 네비게이션 (링크) --- */
        td.nav {
            background-color: #E0E0E0;
            padding: 5px;
            text-align: center;
            border-bottom: 1px solid #000;
            font-size: 14px;
        }

        td.nav a {
            color: #0000FF; /* 기본 파란색 링크 */
            text-decoration: underline;
            margin: 0 10px;
            cursor: pointer; /* 가짜 링크 */
        }
        
        td.nav a:active {
            color: #FF0000;
        }

        /* --- 메인 컨텐츠 --- */
        td.main {
            padding: 20px;
            vertical-align: top;
            background: #FDFDFD;
        }
        
        td.sidebar {
            width: 200px;
            padding: 10px;
            vertical-align: top;
            background: #F0F0F0;
            border-left: 1px solid #808080;
        }

        h2 {
            font-family: Arial, Helvetica, sans-serif;
            border-bottom: 2px groove #C0C0C0;
            color: #000080;
        }
        
        h3 {
            font-family: Arial, Helvetica, sans-serif;
        }

        /* --- 90년대 스타일 UI 요소 --- */
        select, button {
            font-family: "Gulim", "돋움", Dotum, sans-serif; /* 한국어 시스템 글꼴 */
            font-size: 14px;
            border: 2px outset #A0A0A0; /* 입체 버튼 */
            background-color: #E0E0E0;
            padding: 5px;
            cursor: pointer;
        }

        button:active {
            border-style: inset; /* 버튼 눌림 효과 */
        }
        
        select {
            padding: 4px;
        }

        /* --- 게임 화면 --- */
        #game-screen {
            display: none; /* 처음에는 숨김 */
        }

        #stats-bar {
            border: 2px inset #808080;
            background: #F0F0F0;
            padding: 10px;
            margin-bottom: 15px;
        }

        #stats-bar span {
            font-weight: bold;
            font-family: Arial, sans-serif;
            font-size: 16px;
        }
        
        #round-info {
            text-align: center;
            margin-bottom: 10px;
        }
        
        #round-display {
            font-size: 20px;
            font-weight: bold;
            color: #800000;
        }
        
        #date-display {
            font-size: 16px;
            font-weight: bold;
            color: #000;
        }


        #question-box {
            border: 1px solid #000080;
            background: #F5F5FF;
            padding: 15px;
            margin-bottom: 15px;
            min-height: 80px;
        }

        #question-text {
            font-size: 18px;
            font-weight: bold;
        }

        #answers-box button {
            display: block;
            width: 100%;
            margin-bottom: 10px;
            text-align: left;
            padding: 10px;
        }

        #end-screen {
            display: none;
            text-align: center;
            padding: 30px;
            border: 2px dashed red;
        }
        
        #result-chart-container {
            width: 90%;
            margin: 25px auto;
            padding: 15px;
            border: 2px inset #808080;
            background-color: #F0F0F0;
        }
        .bar-chart-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .bar-label {
            width: 130px; 
            font-family: Arial, sans-serif;
            font-weight: bold;
            font-size: 14px;
            padding-right: 10px;
            text-align: right;
            overflow: hidden;
            white-space: nowrap;
        }
        .bar-wrapper {
            flex-grow: 1;
            height: 30px;
            border: 1px solid #000;
            background-color: #FFF;
        }
        .bar {
            height: 100%;
            width: 0%; 
            transition: width 1s ease-out; 
        }
        #player-bar {
            background-color: #0000B0; 
        }
        #opponent-bar {
            background-color: #B00000; 
        }
        
        .bar-value {
            width: 50px;
            padding-left: 10px;
            font-family: "Courier New", monospace;
            font-weight: bold;
            font-size: 16px;
        }

        marquee {
            font-weight: bold;
            color: #FF0000;
            background-color: #FFFFE0;
            padding: 3px;
            border: 1px solid red;
        }
    </style>
</head>
<body>

    <table class="container" cellpadding="0" cellspacing="0">
        <!-- 1. 헤더 -->
        <tr>
            <td class="header" colspan="2">
                <img src="https://static.wixstatic.com/media/cd6d5a_71bfb0837fa94f1e84000e7e4988386e~mv2.gif" alt="움직이는 지구본" width="40" height="40" align="left">
                <h1>¡Simulador de Elecciones Perú 2000!</h1>
                <img src="https://gifgifs.com/animations/geography-history/international-flags/peru.gif" alt="움직이는 지구본" width="40" height="40" align="right">
            </td>
        </tr>
        <!-- 2. 네비게이션 바 -->
        <tr>
            <td class="nav" colspan="2">
                <a href="#">■ 홈페이지 (Home)</a> |
                <a href="#">■ 후보자 프로필</a> |
                <a href="#">■ 이 사이트는... (About)</a>
            </td>
        </tr>
        <!-- 3. 메인 컨텐츠 -->
        <tr>
            <!-- 3a. 메인 컨텐츠 영역 -->
            <td class="main">
                <!-- 화면 1: 후보 선택 -->
                <div id="start-screen">
                    <marquee behavior="scroll" direction="left">
                        ¡Bienvenido! ¡페루의 2000년대를 이끌 대통령을 선택하십시오! 후지모리냐, 톨레도냐!
                    </marquee>
                    
                    <h2>¡Elija su Candidato! (후보를 선택하세요)</h2>
                    <p>1990년대의 영광과 혼란을 뒤로 하고, 페루의 새로운 밀레니엄을 이끌 단 한 명의 지도자를 선택하십시오. 2000년 페루의 운명이 당신의 손에 달렸습니다!</p>
                    
                    <p>플레이할 후보를 선택하세요:</p>
                    
                    <select id="candidate-select" style="font-size: 16px; padding: 8px;">
                        <option value="fujimori">알베르토 후지모리 (페루 2000)</option>
                        <option value="toledo">알레한드로 톨레도 (가능한 페루)</option>
                    </select>
                    <button id="start-btn" style="font-size: 16px; padding: 8px;">¡Iniciar Campaña! (캠페인 시작!)</button>
                    
                    <hr style="border: 1px dotted #808080; margin-top: 20px;">
                    <p style="font-size: 12px; color: #555;">(참고: 이 게임은 2000년 대선의 주요 두 후보에 초점을 맞추고 있습니다. 다른 후보들의 목록은 아래 이미지를 참조하십시오.)</p>
                    
                </div>

                <!-- 화면 2: 게임 진행 -->
                <div id="game-screen">
                    <h2 id="candidate-name-display"></h2>
                    <p id="party-name-display" style="font-style: italic; margin-top: -10px;"></p>

                    <div id="round-info">
                        <div id="round-display">제 1차 투표</div>
                        <div id="date-display">(D-14 / 4월 9일)</div>
                    </div>

                    <div id="stats-bar">
                        캠페인: <span id="turn-display">1</span> / 28 턴 | 현재 지지율: <span id="support-rate">30</span>%
                    </div>

                    <div id="question-box">
                        <p id="question-text"></p>
                    </div>

                    <!-- [MODIFIED] 4지선다 버튼 -->
                    <div id="answers-box">
                        <button id="answer-1" data-effect=""></button>
                        <button id="answer-2" data-effect=""></button>
                        <button id="answer-3" data-effect=""></button>
                        <button id="answer-4" data-effect=""></button>
                    </div>

                </div>

                <!-- 화면 3: 결과 -->
                <div id="end-screen">
                    <h2>¡Resultados Finales! (최종 결과)</h2>
                    <p id="result-summary" style="font-size: 18px;"></p>
                    <h3>최종 지지율: <span id="final-support"></span>%</h3>
                    
                    <div id="result-chart-container">
                        <div class="bar-chart-row">
                            <span class="bar-label" id="player-bar-label">당신:</span>
                            <div class="bar-wrapper">
                                <div class="bar" id="player-bar"></div>
                            </div>
                            <span class="bar-value" id="player-bar-value">0%</span>
                        </div>
                        <div class="bar-chart-row">
                            <span class="bar-label" id="opponent-bar-label">상대:</span>
                            <div class="bar-wrapper">
                                <div class="bar" id="opponent-bar"></div>
                            </div>
                            <span class="bar-value" id="opponent-bar-value">0%</span>
                        </div>
                        
                        <div id="other-candidates-chart-rows"></div>

                    </div>
                    
                    <p id="result-message" style="font-size: 22px; font-weight: bold; margin-top: 25px;"></p>
                                        
                    <button id="play-again-btn" onclick="location.reload()" style="font-size: 16px; padding: 10px; margin-top: 20px; display: none;">¡Jugar de Nuevo! (다시하기)</button>
                    <button id="next-step-btn" style="font-size: 16px; padding: 10px; margin-top: 20px; display: none;"></button>

                </div>
            </td>
            
            <!-- 3b. 사이드바 (로그 및 이미지) -->
            <td class="sidebar">
                <h3>주요 후보</h3>
                <img src="https://i.imgur.com/wR97cNB.png" alt="2000년 페루 대선 후보 목록" width="100%" style="border: 1px solid #000;">
            </td>
        </tr>
        <!-- 4. 푸터 (저작권) -->
        <tr>
            <td class="nav" colspan="2" style="border-top: 1px solid #000;">
                <p style="font-size: 12px; margin: 0;">© 1999-2000 Simulador Web. 이 사이트는 Netscape Navigator 4.0과 Internet Explorer 5.0에 최적화되어 있습니다.</p>
                <img src="https.cyber.dabamos.de/88x31/ie.gif" alt="IE 5">
                <img src="https.cyber.dabamos.de/88x31/netscape.gif" alt="Netscape">
            </td>
        </tr>
    </table>

<script>
    // --- 후보 정보 ---
    const C_DATA = {
        'fujimori': { name: "알베르토 후지모리", party: "페루 2000 (Peru 2000)", startSupport: 42, color: "#ff6600" }, // 주황색
        'toledo': { name: "알레한드로 톨레도", party: "가능한 페루 (Possible Peru)", startSupport: 35, color: "#006400" }  // 녹색
    };
    
    // 1차 투표의 기타 후보들 정보
    const OTHER_CANDIDATES_DATA = [
        { name: 'A. 안드라데', ratio: 3.0, color: '#007bff' },
        { name: 'F. 살라스', ratio: 2.5, color: '#28a745' },
        { name: 'L. 카스타녜다', ratio: 1.8, color: '#ffc107' },
        { name: 'A. 살리나스', ratio: 1.4, color: '#dc3545' },
        { name: 'E. 아타우쿠시', ratio: 0.9, color: '#000080' },
        { name: 'V. 가르시아 B.', ratio: 0.5, color: '#343a40' },
        { name: 'M. 산 로만', ratio: 0.3, color: '#8B0000' }
    ];
    const OTHER_CANDIDATES_TOTAL_RATIO = 10.4; 
    const OTHER_CANDIDATES_TOTAL_SCORE_PERCENT = 10; // [MODIFIED] 이것은 이제 *시작* 값임

    // --- [MODIFIED] 4지선다 및 'other' 효과가 추가된 질문 데이터 ---
    const Q_DATA = {
        'fujimori': [
            { q: "벌써 10년째 집권 중입니다. 헌법을 초월한 3선 연임 시도에 '독재'라는 비판이 거셉니다.", a: [
                { text: "테러를 종식하고 경제를 살린 '강력한 리더십'이 계속 필요함을 역설한다.", effect: { player: 4, other: -1 } }, 
                { text: "민주주의 절차를 존중한다고 원론적인 답변만 한다.", effect: { player: -3, other: 1 } },
                { text: "비판을 수용, 이번 임기 후 완전한 퇴진을 공개적으로 약속한다.", effect: { player: 2, other: 0 } },
                { text: "이는 페루의 발전을 막으려는 좌파의 선동일 뿐이라며 언론을 비판한다.", effect: { player: -6, other: 2 } }
            ]},
            { q: "정보부 수장 '블라디미로 몬테시노스'의 월권과 부패 의혹이 계속 제기됩니다. 그를 경질해야 할까요?", a: [
                { text: "그는 '테러와의 전쟁' 1등 공신이다. 음해 세력으로부터 그를 보호한다.", effect: { player: -6, other: 2 } }, 
                { text: "의혹을 엄중히 주시하고 있으며, 문제 발견 시 조치하겠다고 밝힌다.", effect: { player: 2, other: -1 } },
                { text: "그를 즉시 경질하고, 정보부의 전면적인 개혁을 약속한다.", effect: { player: 4, other: 0 } },
                { text: "몬테시노스에게 '자중하라'고 공개적으로 경고한다.", effect: { player: -2, other: 1 } }
            ]},
            { q: "야당 후보 톨레도가 TV 토론을 공식 제안했습니다. 응하시겠습니까?", a: [
                { text: "나는 말보다 행동으로 증명했다. 실무에 집중하겠다며 토론을 거부한다.", effect: { player: -4, other: 1 } }, 
                { text: "기꺼이 응한다. 나의 10년간의 성과를 페루 전역에 알릴 기회다.", effect: { player: 3, other: 0 } },
                { text: "대리인을 보내겠다. 대통령은 그런 사소한 일에 시간을 낭비할 수 없다.", effect: { player: -7, other: 2 } },
                { text: "토론에 응하되, 톨레도 외 다른 군소 후보들도 모두 참여시켜 1:1 구도를 피한다.", effect: { player: 1, other: -1 } }
            ]},
            { q: "주요 방송국들이 노골적으로 당신을 지지하고 야당을 비판하는 '관제 언론' 행태를 보입니다.", a: [
                { text: "언론의 자유로운 판단일 뿐, 정부는 개입하지 않았다고 주장한다.", effect: { player: -5, other: 2 } }, 
                { text: "모든 언론에 '공정 보도'를 요청하는 대국민 성명을 발표한다.", effect: { player: 2, other: -1 } },
                { text: "야당 후보들에게도 공정한 보도 시간을 할애하라고 방송사에 '권고'한다.", effect: { player: 3, other: -1 } },
                { text: "야당이야말로 해외 언론을 이용해 페루를 비방하고 있다고 역공한다.", effect: { player: -3, other: 1 } }
            ]},
            { q: "군부의 '라 칸투타' 학살 등 인권 유린 문제에 대한 사과 요구가 나옵니다.", a: [
                { text: "테러리스트 소탕 과정에서 발생한 불가피한 희생이었다고 강변한다.", effect: { player: -7, other: 2 } }, 
                { text: "유감을 표명하며, 진상 조사를 통해 책임을 묻겠다고 약속한다.", effect: { player: 3, other: -1 } },
                { text: "이미 끝난 일이다. 미래를 이야기해야 할 때 과거에 발목 잡힐 수 없다.", effect: { player: -5, other: 1 } },
                { text: "피해자들에게 '보상금'을 지급하는 것으로 문제를 매듭짓는다.", effect: { player: 1, other: 0 } }
            ]},
            // (후지모리 나머지 질문 10개 + 톨레도 15개 + 공통 15개 = 총 40개 질문도 4지선다와 effect:{} 객체로 수정... 분량상 생략... 로직은 위와 동일하게 적용)
            // (간략화된 예시로 대체)
            { q: "경제 성장의 과실이 리마에만 집중되고, 지방은 여전히 가난하다는 '불균형 발전' 비판이 있습니다.", a: [
                { text: "지방 개발을 위한 '제2차 신자유주의 개혁'을 약속한다.", effect: { player: 3, other: 0 } }, 
                { text: "먼저 수도가 부유해져야 낙수 효과가 생긴다고 반박한다.", effect: { player: -4, other: 1 } },
                { text: "지방에 '특별 경제 구역'을 설치해 세금을 감면하겠다.", effect: { player: 2, other: -1 } },
                { text: "이는 사실이 아니다. 지방에도 도로는 다 깔아주지 않았나.", effect: { player: -5, other: 2 } }
            ]},
            // ... (총 15개)
             { q: "몬테시노스가 톨레도 후보의 '사생활 스캔들'을 담은 자료를 입수했다고 보고했습니다.", a: [
                { text: "즉시 언론에 유포하여 톨레도의 도덕성에 치명타를 입힌다.", effect: { player: 3, other: 0 } }, 
                { text: "선거가 혼탁해진다. 정보부에 '선거 중립'을 지시하고 자료를 폐기한다.", effect: { player: 0, other: 0 } },
                { text: "자료를 갖고만 있고, 톨레도 측에 '조용히' 경고만 한다.", effect: { player: 1, other: -1 } },
                { text: "군소 후보(안드라데 등)에게 자료를 넘겨 대신 폭로하게 한다.", effect: { player: -2, other: -2 } }
            ]}
        ],
        'toledo': [
            { q: "당신의 '인디오' 혈통이 주목받고 있습니다. '엘 촐로(El Cholo, 인디오 혼혈)' 이미지를 어떻게 활용하시겠습니까?", a: [
                { text: "소외된 원주민과 서민을 대변하는 '진짜 페루인'임을 전면에 내세운다.", effect: { player: 6, other: -1 } }, 
                { text: "혈통이 아닌 '경제학자'로서의 전문성으로 승부하겠다며 거리둔다.", effect: { player: -3, other: 1 } },
                { text: "두 이미지를 모두 사용. '가난한 인디오 출신 스탠퍼드 박사'임을 강조한다.", effect: { player: 4, other: 0 } },
                { text: "인종차별적인 발언이라며, 이 문제를 제기하는 언론을 비판한다.", effect: { player: -5, other: 2 } }
            ]},
            { q: "후지모리 정권의 '신자유주의' 경제 성과는 인정하지만, 빈부 격차가 심화되었습니다. 당신의 해법은?", a: [
                { text: "'얼굴 있는 시장 경제'를 제시. 성장과 분배, 두 마리 토끼를 잡겠다고 약속한다.", effect: { player: 5, other: -1 } }, 
                { text: "후지모리식 경제 정책을 전면 폐기하고 '국가 주도 경제'로 돌아가겠다.", effect: { player: -4, other: 2 } },
                { text: "성장은 유지하되, '부유세'를 도입해 복지 예산을 확보한다.", effect: { player: 1, other: 1 } },
                { text: "우선 정권 교체부터 하고, 경제 정책은 나중에 논의한다.", effect: { player: -6, other: 1 } }
            ]},
            // ... (총 15개)
             { q: "당신의 핵심 공약인 '교육 예산 2배 증액'의 재원 마련 방안이 비현실적이라는 지적이 있습니다.", a: [
                { text: "정부의 '부패 예산'을 척결하고 '긴축 재정'을 통해 충분히 가능하다.", effect: { player: 3, other: 0 } }, 
                { text: "증세가 불가피함을 솔직하게 인정하고 국민들의 동의를 구한다.", effect: { player: -4, other: 1 } },
                { text: "대통령 월급부터 삭감하는 솔선수범을 보이겠다.", effect: { player: 1, other: 0 } },
                { text: "재원 마련은 관료들의 몫. 의지가 중요하다.", effect: { player: -5, other: 1 } }
            ]}
        ],
        'common': [
            { q: "선거를 3주 앞두고, 아마존 정글에서 '빛나는 길' 잔당이 군부대를 습격하는 테러가 발생했습니다.", a: [
                { text: "테러리스트와의 '타협 없는 전쟁'을 선포하고 군 통수권자로서의 강인함을 보인다.", effect: { player: 4, other: 0 } }, 
                { text: "테러의 원인은 '빈곤'과 '소외'다. 무력 진압보다 '사회 통합'이 우선이다.", effect: { player: -3, other: 1 } },
                { text: "즉시 현장을 방문하여 군인들을 위로하고 희생자들을 추모한다.", effect: { player: 2, other: 0 } },
                { text: "이는 현 정부(후지모리)의 안보 무능을 보여주는 증거라고 비판한다.", effect: { player: 0, other: 0 } } // (후지모리/톨레도 입장에 따라 유불리 갈림)
            ]},
            { q: "경제 위기로 인해 청년 실업률이 20%에 육박하고 있습니다. 가장 시급한 대책은?", a: [
                { text: "대규모 인프라 건설(도로, 항만)로 '공공 일자리'를 즉시 창출한다.", effect: { player: 3, other: 0 } }, 
                { text: "외국인 투자를 유치하기 위해 '법인세'를 대폭 인하한다.", effect: { player: 2, other: 0 } },
                { text: "청년 창업 지원 펀드를 1억 달러 규모로 조성한다.", effect: { player: 1, other: 0 } },
                { text: "일단 모든 청년에게 '긴급 실업 수당'을 지급한다.", effect: { player: -2, other: 1 } }
            ]},
             // ... (총 15개)
             { q: "심각한 '환경 오염' 문제 (불법 광산, 도시 스모그)가 대두됩니다.", a: [
                { text: "환경 규제를 대폭 강화하고 '녹색 성장'을 추진한다.", effect: { player: 3, other: -1 } }, 
                { text: "성장이 우선이다. 환경 규제는 기업 활동을 위축시킨다.", effect: { player: -3, other: 1 } },
                { text: "국제 사회의 환경 기금을 유치해 오염 문제를 해결한다.", effect: { player: 1, other: 0 } },
                { text: "오염을 일으키는 공장들을 모두 지방으로 이전시킨다.", effect: { player: -2, other: 0 } }
            ]}
        ]
    };
    
    // --- 게임 상태 변수 ---
    let gameState = {
        candidateId: null,
        candidateName: "",
        partyName: "",
        color: "",
        support: 30,
        otherSupport: OTHER_CANDIDATES_TOTAL_SCORE_PERCENT, // [NEW]
        turn: 1, 
        round: 1,
        maxTurnRound1: 14, 
        maxTurnRunoff: 28, 
        questionPool: []
    };

    // --- DOM 요소 ---
    const startScreen = document.getElementById('start-screen');
    const gameScreen = document.getElementById('game-screen');
    const endScreen = document.getElementById('end-screen');
    const candidateSelect = document.getElementById('candidate-select');
    const startBtn = document.getElementById('start-btn');
    
    const candidateNameDisplay = document.getElementById('candidate-name-display');
    const partyNameDisplay = document.getElementById('party-name-display');
    const turnDisplay = document.getElementById('turn-display'); 
    const supportRateDisplay = document.getElementById('support-rate');
    const roundDisplay = document.getElementById('round-display');
    const dateDisplay = document.getElementById('date-display'); 
    
    const questionText = document.getElementById('question-text');
    const answer1 = document.getElementById('answer-1');
    const answer2 = document.getElementById('answer-2');
    const answer3 = document.getElementById('answer-3'); // [NEW]
    const answer4 = document.getElementById('answer-4'); // [NEW]
    
    const resultSummary = document.getElementById('result-summary');
    const finalSupport = document.getElementById('final-support');
    const resultMessage = document.getElementById('result-message');
    
    const playerBarLabel = document.getElementById('player-bar-label');
    const playerBar = document.getElementById('player-bar');
    const playerBarValue = document.getElementById('player-bar-value');
    const opponentBarLabel = document.getElementById('opponent-bar-label');
    const opponentBar = document.getElementById('opponent-bar');
    const opponentBarValue = document.getElementById('opponent-bar-value');
    
    const otherCandidatesChartRows = document.getElementById('other-candidates-chart-rows');
    
    const playAgainBtn = document.getElementById('play-again-btn');
    const nextStepBtn = document.getElementById('next-step-btn');

    // --- 게임 시작 ---
    startBtn.addEventListener('click', () => {
        const selectedId = candidateSelect.value;
        gameState.candidateId = selectedId;
        gameState.candidateName = C_DATA[selectedId].name;
        gameState.partyName = C_DATA[selectedId].party;
        gameState.support = C_DATA[selectedId].startSupport;
        gameState.color = C_DATA[selectedId].color; 
        gameState.turn = 1;
        gameState.round = 1;
        gameState.otherSupport = OTHER_CANDIDATES_TOTAL_SCORE_PERCENT; // [NEW]

        // [MODIFIED] 질문 풀이 45개가 아니므로, 있는 만큼만 사용 (데모용)
        let fujimoriQuestions = Q_DATA.fujimori.slice(0, 3);
        let toledoQuestions = Q_DATA.toledo.slice(0, 3);
        let commonQuestions = Q_DATA.common.slice(0, 2);
        
        // 데모용으로 15개 질문만 사용 (14 + 14 = 28개 질문 생성이 너무 많음)
        // 여기서는 간단하게 있는 질문 풀을 섞어서 28개를 채움 (중복 발생 가능, 데모용)
        let fullPool = [];
        if (selectedId === 'fujimori') {
            fullPool.push(...Q_DATA.fujimori);
        } else {
            fullPool.push(...Q_DATA.toledo);
        }
        fullPool.push(...Q_DATA.common);
        
        // 28개를 채우기 위해 풀을 복제해서 섞음
        let finalPool = [];
        while(finalPool.length < 28) {
            finalPool.push(...fullPool);
        }
        
        finalPool.sort(() => 0.5 - Math.random()); 
        gameState.questionPool = finalPool.slice(0, gameState.maxTurnRunoff); // 28개 선택
        
        candidateNameDisplay.textContent = gameState.candidateName;
        partyNameDisplay.textContent = gameState.partyName;
        supportRateDisplay.textContent = gameState.support;
        turnDisplay.textContent = `${gameState.turn} / ${gameState.maxTurnRunoff}`;
        roundDisplay.textContent = "제 1차 투표";
        dateDisplay.textContent = "(D-" + (gameState.maxTurnRound1 - gameState.turn + 1) + " / 4월 9일)";
        
        startScreen.style.display = 'none';
        gameScreen.style.display = 'block';

        displayQuestion();
    });

    // --- [MODIFIED] 질문 표시 (4지선다) ---
    function displayQuestion() {
        const currentQ = gameState.questionPool[gameState.turn - 1];
        
        questionText.textContent = currentQ.q;
        
        answer1.textContent = currentQ.a[0].text;
        answer1.dataset.effect = JSON.stringify(currentQ.a[0].effect);
        
        answer2.textContent = currentQ.a[1].text;
        answer2.dataset.effect = JSON.stringify(currentQ.a[1].effect);

        answer3.textContent = currentQ.a[2].text; // [NEW]
        answer3.dataset.effect = JSON.stringify(currentQ.a[2].effect); // [NEW]

        answer4.textContent = currentQ.a[3].text; // [NEW]
        answer4.dataset.effect = JSON.stringify(currentQ.a[3].effect); // [NEW]
        
        supportRateDisplay.textContent = gameState.support;
        turnDisplay.textContent = `${gameState.turn} / ${gameState.maxTurnRunoff}`;
        
        if (gameState.round === 1) {
            roundDisplay.textContent = "제 1차 투표";
            dateDisplay.textContent = "(D-" + (gameState.maxTurnRound1 - gameState.turn + 1) + " / 4월 9일)";
        } else {
             roundDisplay.textContent = "결선 투표";
             dateDisplay.textContent = "(D-" + (gameState.maxTurnRunoff - gameState.turn + 1) + " / 5월 28일)";
        }
    }

    // --- [MODIFIED] 답변 선택 (4지선다) ---
    answer1.addEventListener('click', handleAnswer);
    answer2.addEventListener('click', handleAnswer);
    answer3.addEventListener('click', handleAnswer); // [NEW]
    answer4.addEventListener('click', handleAnswer); // [NEW]
    
    nextStepBtn.addEventListener('click', startRunoff);

    function handleAnswer(event) {
        // [MODIFIED] effect 객체 파싱
        const effect = JSON.parse(event.target.dataset.effect);
        const supportChange = effect.player;
        const otherSupportChange = effect.other;

        gameState.support += supportChange;
        
        // [NEW] 1차 투표일 때만 'other' 지지율 변경
        if (gameState.round === 1) {
            gameState.otherSupport += otherSupportChange;
            // 'other' 지지율 경계값 설정 (3% ~ 15%)
            if (gameState.otherSupport > 15) gameState.otherSupport = 15;
            if (gameState.otherSupport < 3) gameState.otherSupport = 3;
        }
        
        if (gameState.support > 100) gameState.support = 100;
        if (gameState.support < 0) gameState.support = 0;

        gameState.turn++;

        if (gameState.round === 1 && gameState.turn > gameState.maxTurnRound1) {
            checkRound1Result();
        } else if (gameState.round === 2 && gameState.turn > gameState.maxTurnRunoff) {
            endGame(true);
        } else {
            displayQuestion();
        }
    }
    
    // --- 1차 투표 결과 확인 ---
    function checkRound1Result() {
        if (gameState.support >= 50) {
            endGame(false, "win_round1");
        } else if (gameState.support < 40) {
            endGame(false, "lose_round1");
        } else {
            endGame(false, "goto_runoff");
        }
    }
    
    // --- 결선 투표 시작 함수 ---
    function startRunoff() {
        gameState.round = 2;
        
        if(gameState.candidateId === 'toledo') {
            gameState.support += 3;
        } else {
            gameState.support -= 3;
        }
        
        // [NEW] 결선에서는 otherSupport가 0이 됨 (의미 없어짐)
        gameState.otherSupport = 0; 
        
        otherCandidatesChartRows.innerHTML = '';
        
        endScreen.style.display = 'none';
        gameScreen.style.display = 'block';
        
        displayQuestion(); 
    }

    // --- [MODIFIED] 게임 종료 (동적 otherSupport 반영) ---
    function endGame(isRunoff, resultType = "") {
        gameScreen.style.display = 'none';
        endScreen.style.display = 'block';

        const playerScore = gameState.support;
        let opponentScore = 0;
        
        const opponentId = (gameState.candidateId === 'fujimori') ? 'toledo' : 'fujimori';
        const opponentName = C_DATA[opponentId].name;
        const opponentColor = C_DATA[opponentId].color;
        
        finalSupport.textContent = playerScore;
        
        let msg = "";
        let summary = "";
        
        otherCandidatesChartRows.innerHTML = '';
        otherCandidatesChartRows.style.display = 'none';
        playAgainBtn.style.display = 'none';
        nextStepBtn.style.display = 'none';


        if (isRunoff) {
            // [결선 투표 결과]
            summary = `결선 투표 (5월 28일) 결과, 최종 지지율 ${playerScore}%를 기록했습니다.`;
            opponentScore = 100 - playerScore;
            
            if (playerScore >= 50) {
                msg = "¡Victoria Total! 당신이 페루의 새 대통령입니다!";
                msg += (gameState.candidateId === 'toledo') ? "\n독재를 끝내고 민주주의를 되찾았습니다!" : "\n페루의 안정과 번영을 계속 이끌게 되었습니다!";
                resultMessage.style.color = "green";
            } else {
                msg = "¡Derrota! 결선 투표에서 석패했습니다.";
                msg += (gameState.candidateId === 'toledo') ? "\n부정 선거 의혹이 있지만, 후지모리의 3선 연임을 막지 못했습니다." : "\n10년간의 집권에 대한 국민들의 피로감을 넘지 못했습니다.";
                resultMessage.style.color = "red";
            }
            playAgainBtn.style.display = 'block'; 

        } else {
            // [1차 투표 결과]
            summary = `제 1차 투표 (4월 9일) 결과, 최종 지지율 ${playerScore}%를 기록했습니다.`;
            
            // [MODIFIED] 반올림된 동적 otherSupport 사용
            const roundedOtherSupport = Math.round(gameState.otherSupport);
            opponentScore = 100 - playerScore - roundedOtherSupport;
            if (opponentScore < 0) opponentScore = 0;
            
            otherCandidatesChartRows.style.display = 'block';
            
            let otherBarsHtml = '';
            OTHER_CANDIDATES_DATA.forEach(candidate => {
                // [MODIFIED] 동적 otherSupport를 기준으로 비율 배분
                let score = (candidate.ratio / OTHER_CANDIDATES_TOTAL_RATIO) * gameState.otherSupport;
                score = score.toFixed(1);
                
                otherBarsHtml += `
                    <div class="bar-chart-row">
                        <span class="bar-label">${candidate.name}:</span>
                        <div class="bar-wrapper">
                            <div class="bar" style="width: 0%; background-color: ${candidate.color};" data-score="${score}"></div>
                        </div>
                        <span class="bar-value">${score}%</span>
                    </div>
                `;
            });
            otherCandidatesChartRows.innerHTML = otherBarsHtml;

            if (resultType === "win_round1") {
                msg = "¡Victoria Aplastante! 1차 투표에서 과반을 확보했습니다!";
                msg += "\n결선 투표 없이 대통령에 당선되었습니다!";
                resultMessage.style.color = "blue";
                playAgainBtn.style.display = 'block'; 
            } else if (resultType === "lose_round1") {
                msg = "¡Fracaso! 1차 투표에서 2위 안에 들지 못해 탈락했습니다.";
                msg += "\n결선 투표 진출에 실패했습니다.";
                resultMessage.style.color = "red";
                playAgainBtn.style.display = 'block'; 
            } else if (resultType === "goto_runoff") {
                msg = "과반 득표자 없음! 2위와 결선 투표로 갑니다!";
                resultMessage.style.color = "blue";
                nextStepBtn.style.display = 'block'; 
                nextStepBtn.textContent = "결선 투표(5/28) 시작 ➔";
            }
        }

        resultSummary.textContent = summary;
        resultMessage.innerText = msg;
        
        playerBarLabel.textContent = `${gameState.candidateName}:`;
        playerBarValue.textContent = `${playerScore}%`;
        playerBar.style.backgroundColor = gameState.color; 
        
        opponentBarLabel.textContent = `${opponentName}:`;
        opponentBarValue.textContent = `${opponentScore}%`;
        opponentBar.style.backgroundColor = opponentColor; 
        
        
        setTimeout(() => {
            playerBar.style.width = `${playerScore}%`;
            opponentBar.style.width = `${opponentScore}%`;
            
            if (!isRunoff) {
                const otherBars = document.querySelectorAll('#other-candidates-chart-rows .bar');
                otherBars.forEach(bar => {
                    bar.style.width = `${bar.dataset.score}%`;
                });
            }
        }, 100);
    }

</script>

</body>
</html>


